<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>Historial de facturas</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
  </head>

  <body class="p-4 bg-light">
    <div class="container py-4">

      <%- include('partials/navbar') %>

      <h1 class="mb-4">Historial de facturas</h1>

      <% if (!facturas || facturas.length === 0) { %>
        <p>No hay facturas pagadas registradas.</p>
      <% } else { %>
        <table class="table table-striped table-sm align-middle">
          <thead>
            <tr>
              <th>Fecha</th>
              <th>Mesa</th>
              <th>Total</th>
              <th>Método</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            <% facturas.forEach(f => { %>
              <tr>
                <td><%= new Date(f.pagadoEn).toLocaleString("es-CR", { timeZone: "America/Costa_Rica" }) %></td>
                <td><%= f.mesa > 10 ? 'Barra ' + (f.mesa - 10) : 'Mesa ' + f.mesa %></td>
                <td>₡<%= f.total.toLocaleString("es-CR") %></td>
                <td><%= f.metodoPago === 'sinpe' ? 'SINPE' : 'Efectivo' %></td>
                <td class="text-end">
                  <a
                    href="/reportes/facturas/<%= f._id %>"
                    class="btn btn-sm btn-outline-primary"
                  >
                    Ver detalle
                  </a>
                </td>
              </tr>
            <% }) %>
          </tbody>
        </table>
      <% } %>

    </div>
  </body>
</html>