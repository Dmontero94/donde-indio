<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>Detalle factura - Donde Indio</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
  </head>

  <body class="p-4 bg-light">
    <div class="container py-4">

      <%- include('partials/navbar') %>

      <h1 class="mb-3">Detalle de factura</h1>

      <div class="mb-3">
        <a href="/reportes/facturas" class="btn btn-secondary btn-sm">
          ⬅ Volver al historial
        </a>
      </div>

      <div class="card mb-4">
        <div class="card-body">
          <h5 class="card-title">
            Mesa <%= factura.mesa %>
          </h5>
          <p class="card-text mb-1">
            <strong>Fecha:</strong>
            <%= new Date(factura.pagadoEn || factura.creadoEn).toLocaleString("es-CR", {
  timeZone: "America/Costa_Rica",
  dateStyle: "short",
  timeStyle: "short"
}) %>
          </p>
          <p class="card-text mb-1">
            <strong>Método de pago:</strong>
            <%= factura.metodoPago === 'sinpe' ? 'SINPE Móvil' : 'Efectivo' %>
          </p>
          <p class="card-text mb-1">
            <strong>Estado:</strong> <%= factura.estado %>
          </p>
          <% if (factura.metodoPago === 'efectivo') { %>
            <p class="card-text mb-1">
              <strong>Monto recibido:</strong>
              ₡<%= factura.montoRecibido.toLocaleString("es-CR") %>
            </p>
            <p class="card-text mb-1">
              <strong>Vuelto:</strong>
              ₡<%= factura.vuelto.toLocaleString("es-CR") %>
            </p>
          <% } %>
          <p class="card-text mt-2">
            <strong>Total:</strong>
            ₡<%= factura.total.toLocaleString("es-CR") %>
          </p>
        </div>
      </div>

      <h3>Productos</h3>

      <% if (!factura.items || factura.items.length === 0) { %>
        <p>No hay productos registrados en esta factura.</p>
      <% } else { %>
        <table class="table table-sm">
          <thead>
            <tr>
              <th>Producto</th>
              <th>Cant</th>
              <th>Precio unitario</th>
              <th>Subtotal</th>
            </tr>
          </thead>
          <tbody>
            <% factura.items.forEach(item => { %>
              <tr>
                <td><%= item.nombreProducto %></td>
                <td><%= item.cantidad %></td>
                <td>₡<%= item.precioUnitario.toLocaleString("es-CR") %></td>
                <td>₡<%= item.subtotal.toLocaleString("es-CR") %></td>
              </tr>
            <% }) %>
          </tbody>
        </table>
      <% } %>

    </div>
  </body>
</html>
